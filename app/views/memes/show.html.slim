header
  = link_to 'Back to Memedex', memes_path, class: 'button'
  h1
    = @meme.slug
    small = " (#{@meme.title})"

.meme id="meme_#{@meme.slug}"
  = image_tag @meme.image_url, class: 'meme-image'

  .meme-actions
    - if user_signed_in?
      = button_to 'Buy',    meme_buy_path(@meme.slug),    method: :post, class: 'buy button'
      = button_to 'Sell',   meme_sell_path(@meme.slug),   method: :post, class: 'sell button'
      = link_to 'Share', share_reddit_url(meme_url(@meme.slug, referrer: current_user.id)), class: 'share button', rel: 'nofollow noreferrer', target: '_blank'
    - else
      = link_to 'Buy',  user_reddit_omniauth_authorize_path, class: 'buy button'
      = link_to 'Sell', user_reddit_omniauth_authorize_path, class: 'sell button'
      = link_to 'Share', share_reddit_url(meme_url(@meme.slug)), class: 'share button', rel: 'nofollow noreferrer', target: '_blank'
    = button_to 'Report', meme_report_path(@meme.slug), method: :post, class: 'report button'
    - if user_signed_in? && current_user == @meme.user
      = link_to 'Edit', edit_meme_path(@meme.slug), class: 'edit button'
      = button_to 'Delete', meme_path(@meme.slug), method: :delete, class: 'button'

  dl.meme-details
    dt Market Price:
    dd = "#{@meme.price} DANK"
    dt Price Change:
    dd = "#{sprintf('%+d', @meme.price_difference)} DANK"
    - if user_signed_in?
      dt Shares Owned:
      dd = current_user.shares.where(meme: @meme).count
      dt Share Value:
      dd = @meme.price * current_user.shares.where(meme: @meme).count

  .meme-description = render_markdown @meme.description

  h2 Derivatives
  .derivatives
    - @meme.children.each do |child|
      = render child
